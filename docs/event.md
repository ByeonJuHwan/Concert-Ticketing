# EVENT-DRIVEN??


## 트랜잭션 범위 

현재 콘서트 좌석 예약 로직에는 아래와 같습니다.
```text
--- 트랜잭션 시작 ---
회원 정보 조회
--- 락 획득 ---
좌석 조회
좌석 상태 검증
좌석 상태 변경
예약 생성
--- 락 반환 ---
--- 트랜잭션 종료 ---
```

예약에 관한 모든 로직이 하나의 트랜잭션에서 동작하므로 좌석 조회가 오래걸리거나, 상태 검증 과정의 소요시간이 오래걸릴 경우 다음과 같은 문제점이 있습니다.
- **DB 커넥션을 오래 지속하는 문제**
- **락 획득 이후 반환까지의 시간이 오래걸리는 문제**
- **비즈니스 로직간의 강한 결합**

트래픽이 적을 경우에는 큰 문제는 없지만 대용량 트래픽이 몰릴 경우 위와 같은 문제는 시스템의 성능 저하를 초래할 수 있습니다.

또 다른 예시를 들어보겠습니다.

콘서트 좌석 예약 기능에 예약한 좌석 정보를 외부 API 로 송신 해주는 기능이 추가된다고 가정해보겠습니다.


```text
기존로직
---
1. 회원 정보 조회
2. 좌석 상태 검증
3. 좌석 상태 변경
4. 예약 생성
---
기능추가
5. 좌석정보 외부 API 송신
```

외부 API로 좌석 정보를 송신하는 기능이 추가되면서, 전체 트랜잭션 시간이 4~5초로 길어집니다. 외부 API 송신은 본래의 비즈니스 로직과 직접적으로 연관이 없지만,
하나의 트랜잭션에 포함되어 있어 통신이 실패할 경우 **영향을 받지 말아야 할 비즈니스 로직까지 전체 롤백되는 문제가 발생합니다.** 
이러한 문제는 시스템의 성능과 안정성을 저하시킬 수 있습니다.

> 정리해보자면 데이터 정합성을 보장하기 위해 트랜잭션을 사용하지만, 
트랜잭션의 범위가 길어질수록 성능 저하와 시스템 병목 등의 추가 문제가 발생할 수 있습니다. 
이러한 문제를 해결하기 위해, 각 기능별로 이벤트를 발행하여 서비스 간 결합도를 낮추고, 
트랜잭션의 길이를 줄임으로써 시스템의 성능과 유연성을 향상시키는 방법을 알아보도록 하겠습니다.


## 이벤트 주도 설계

어플리케이션에 EVENT 를 발행 및 구독 하게 비즈니스로직을 구현한다고 하면 어떻게 활용할 수 있을까요?

- 비대해진 트랜잭션 내의 각 작업을 작은 단위의 트랜잭션으로 분리 가능합니다
- 특정 작업이 완료되었을 때, 후속 작업이 이벤트에 의해 Trigger 되도록 구성함으로써 과도하게 많은 비즈니스 로직을 알고 있을 필요가 없습니다
- 트랜잭션 내에서 외부 API 호출의 실패나 수행이 주요 비즈니스 로직에 영향을 주지 않도록 구성할 수 있습니다

그러면 이제 스프링 환경에서 이벤트를 발행함으로써 각 서비스 간의 의존도를 낮추는 방법과 작업을
외부 API 통신 이라는 기능을 추가하면서 구현해 보겠습니다.

### EventPublisher

스프링에서는 `ApplicationEvent`

