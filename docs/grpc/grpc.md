# GRPC 도입

현재 콘서트 예약 시스템은 MSA 아키텍처로 구성되어 있으며, Payment, Concert, User 등 여러 서비스 간의 통신이 빈번하게 발생합니다.

특히 결제 프로세스에서는 단일 사용자 요청에 대해 다음과 같은 서비스 간 통신이 연쇄적으로 발생합니다.

현재 이러한 모든 통신은 HTTP/1.1 기반의 RESTful API로 구현되어 있습니다.

RESTful API는 널리 사용되는 API 이지만 장점만 있는것은 아니었습니다

- 연결 오버헤드 : 매 요청마다 TCP `handshake` HTTP 헤더 파싱이 반복됩니다.
- Head-of-Line Blocking : HTTP/1.1은 요청을 순차적으로 처리하기 때문에, 
  하나의 느린 요청이 뒤따르는 요청들을 지연시킵니다.
- 비효율적인 직렬화: JSON 기반 데이터 전송으로 인한 파싱 오버헤드와 네트워크 대역폭 낭비가 발생합니다.

이로 인해서 네트워크 리소스 낭비, 높은 지연 시간 문제등이 발생하고 있었습니다.

위 문제를 해결하기 위해 gRPC를 도입하기로 결정했습니다.

### 왜 gGPC 인가?

우선 HTTP 1.1 의 문제점을 gRPC 에서 어떻게 해결했는지 알아보겠습니다

#### 멀티플랙싱 

- **단일 TCP 연결에서 멀티플랙싱 사용** : 하나의 연결로 여러 요청을 동시에 처리합니다
- 연결 재사용으로 `handshake` 오버헤드를 제거합니다
- 헤더의 경우 매 요청마다 전송하지만 이미 전송된 헤더의 경우 인덱스를 바라보도록해 헤더 파싱 오버헤드를 줄입니다.


#### Protocol Buffers를 통한 효율적인 데이터 직렬화

**JSON**
- 텍스트 기반으로 데이터 크기가 큼
- 필드명이 매번 전송됨
- 파싱 오버헤드 큼

**gRPC 개선**
- **바이너리 직렬화**로 데이터 크기 약 60~80% 감소
- 필드명 대신 필드 변호 사용
- 빠른 인코딩/디코딩 속도

코루틴 사용해서 실행시 91ms <-> Http 897ms